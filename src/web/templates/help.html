{% extends "base.html" %}

{% block title %}Помощь - DevDataSorter{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-1">
                    <i class="fas fa-question-circle me-2 text-primary"></i>
                    Помощь и документация
                </h2>
                <p class="text-muted mb-0">Руководство пользователя и часто задаваемые вопросы</p>
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary" onclick="searchHelp()">
                    <i class="fas fa-search me-2"></i>
                    Поиск
                </button>
                <button class="btn btn-primary" onclick="contactSupport()">
                    <i class="fas fa-envelope me-2"></i>
                    Связаться с поддержкой
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Search Bar -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body py-3">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" class="form-control" id="helpSearch" placeholder="Поиск по документации...">
                    <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Sidebar Navigation -->
    <div class="col-lg-3 col-md-4 mb-4">
        <div class="card sticky-top" style="top: 1rem;">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-list me-2"></i>
                    Содержание
                </h6>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush" id="helpNavigation">
                    <a href="#getting-started" class="list-group-item list-group-item-action">
                        <i class="fas fa-play-circle me-2 text-success"></i>
                        Начало работы
                    </a>
                    <a href="#dashboard" class="list-group-item list-group-item-action">
                        <i class="fas fa-tachometer-alt me-2 text-primary"></i>
                        Дашборд
                    </a>
                    <a href="#search" class="list-group-item list-group-item-action">
                        <i class="fas fa-search me-2 text-info"></i>
                        Поиск файлов
                    </a>
                    <a href="#files" class="list-group-item list-group-item-action">
                        <i class="fas fa-folder me-2 text-warning"></i>
                        Файловый менеджер
                    </a>
                    <a href="#reports" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-bar me-2 text-danger"></i>
                        Отчеты
                    </a>
                    <a href="#settings" class="list-group-item list-group-item-action">
                        <i class="fas fa-cog me-2 text-secondary"></i>
                        Настройки
                    </a>
                    <a href="#api" class="list-group-item list-group-item-action">
                        <i class="fas fa-code me-2 text-dark"></i>
                        API документация
                    </a>
                    <a href="#faq" class="list-group-item list-group-item-action">
                        <i class="fas fa-question me-2 text-purple"></i>
                        FAQ
                    </a>
                    <a href="#troubleshooting" class="list-group-item list-group-item-action">
                        <i class="fas fa-tools me-2 text-orange"></i>
                        Устранение неполадок
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="col-lg-9 col-md-8">
        <div class="help-content">
            <!-- Getting Started -->
            <section id="getting-started" class="mb-5">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-play-circle me-2"></i>
                            Начало работы
                        </h4>
                    </div>
                    <div class="card-body">
                        <h5>Добро пожаловать в DevDataSorter!</h5>
                        <p>DevDataSorter - это мощная система для организации, анализа и управления файлами разработки. Следуйте этому руководству для быстрого старта.</p>
                        
                        <h6>Первые шаги:</h6>
                        <ol>
                            <li><strong>Настройка системы:</strong> Перейдите в раздел "Настройки" и укажите папки для сканирования</li>
                            <li><strong>Запуск индексации:</strong> Нажмите кнопку "Начать сканирование" на главной странице</li>
                            <li><strong>Просмотр результатов:</strong> Используйте дашборд для анализа найденных файлов</li>
                            <li><strong>Поиск файлов:</strong> Воспользуйтесь расширенным поиском для нахождения нужных файлов</li>
                        </ol>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-lightbulb me-2"></i>
                            <strong>Совет:</strong> Начните с небольшой папки для тестирования функциональности системы.
                        </div>
                        
                        <h6>Основные возможности:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <ul>
                                    <li>Автоматическая категоризация файлов</li>
                                    <li>Интеллектуальный поиск</li>
                                    <li>Анализ дубликатов</li>
                                    <li>Статистика и отчеты</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul>
                                    <li>Файловый менеджер</li>
                                    <li>Экспорт данных</li>
                                    <li>API для интеграции</li>
                                    <li>Настраиваемые фильтры</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Dashboard -->
            <section id="dashboard" class="mb-5">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            Дашборд
                        </h4>
                    </div>
                    <div class="card-body">
                        <p>Дашборд предоставляет общий обзор вашей файловой системы и ключевые метрики.</p>
                        
                        <h6>Основные элементы:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-chart-pie text-primary me-2"></i>Статистика</h6>
                                <ul>
                                    <li>Общее количество файлов</li>
                                    <li>Общий размер данных</li>
                                    <li>Количество категорий</li>
                                    <li>Проиндексированные файлы</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-chart-bar text-success me-2"></i>Графики</h6>
                                <ul>
                                    <li>Распределение по категориям</li>
                                    <li>Размеры файлов</li>
                                    <li>Активность по времени</li>
                                    <li>Языки программирования</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="alert alert-success">
                            <i class="fas fa-info-circle me-2"></i>
                            Дашборд автоматически обновляется при изменении данных.
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Search -->
            <section id="search" class="mb-5">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-search me-2"></i>
                            Поиск файлов
                        </h4>
                    </div>
                    <div class="card-body">
                        <p>Система поиска позволяет быстро находить нужные файлы по различным критериям.</p>
                        
                        <h6>Типы поиска:</h6>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Тип</th>
                                        <th>Описание</th>
                                        <th>Пример</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>Простой</code></td>
                                        <td>Поиск по имени файла</td>
                                        <td>config.js</td>
                                    </tr>
                                    <tr>
                                        <td><code>Регулярные выражения</code></td>
                                        <td>Поиск по шаблону</td>
                                        <td>*.js, test_*.py</td>
                                    </tr>
                                    <tr>
                                        <td><code>Содержимое</code></td>
                                        <td>Поиск внутри файлов</td>
                                        <td>function main</td>
                                    </tr>
                                    <tr>
                                        <td><code>Метаданные</code></td>
                                        <td>Поиск по свойствам</td>
                                        <td>размер > 1MB</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <h6>Фильтры:</h6>
                        <ul>
                            <li><strong>Категории:</strong> Фильтрация по типу файлов</li>
                            <li><strong>Размер:</strong> Диапазон размеров файлов</li>
                            <li><strong>Дата:</strong> Период создания/изменения</li>
                            <li><strong>Теги:</strong> Пользовательские метки</li>
                            <li><strong>Путь:</strong> Расположение в файловой системе</li>
                        </ul>
                        
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Внимание:</strong> Поиск по содержимому может занять больше времени для больших файлов.
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Files -->
            <section id="files" class="mb-5">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h4 class="mb-0">
                            <i class="fas fa-folder me-2"></i>
                            Файловый менеджер
                        </h4>
                    </div>
                    <div class="card-body">
                        <p>Файловый менеджер предоставляет удобный интерфейс для работы с файлами.</p>
                        
                        <h6>Возможности:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-eye text-info me-2"></i>Просмотр</h6>
                                <ul>
                                    <li>Список и сетка</li>
                                    <li>Предпросмотр файлов</li>
                                    <li>Сортировка и фильтрация</li>
                                    <li>Навигация по папкам</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-tools text-warning me-2"></i>Операции</h6>
                                <ul>
                                    <li>Скачивание файлов</li>
                                    <li>Копирование и перемещение</li>
                                    <li>Переименование</li>
                                    <li>Удаление</li>
                                </ul>
                            </div>
                        </div>
                        
                        <h6>Горячие клавиши:</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <tbody>
                                    <tr>
                                        <td><kbd>Ctrl + A</kbd></td>
                                        <td>Выделить все</td>
                                    </tr>
                                    <tr>
                                        <td><kbd>Delete</kbd></td>
                                        <td>Удалить выбранные</td>
                                    </tr>
                                    <tr>
                                        <td><kbd>F2</kbd></td>
                                        <td>Переименовать</td>
                                    </tr>
                                    <tr>
                                        <td><kbd>Ctrl + C</kbd></td>
                                        <td>Копировать</td>
                                    </tr>
                                    <tr>
                                        <td><kbd>Ctrl + X</kbd></td>
                                        <td>Вырезать</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Reports -->
            <section id="reports" class="mb-5">
                <div class="card">
                    <div class="card-header bg-danger text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>
                            Отчеты
                        </h4>
                    </div>
                    <div class="card-body">
                        <p>Система отчетов позволяет создавать детальные анализы ваших данных.</p>
                        
                        <h6>Типы отчетов:</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <ul>
                                    <li><strong>Обзор файлов:</strong> Общая статистика</li>
                                    <li><strong>Анализ категорий:</strong> Распределение по типам</li>
                                    <li><strong>Размеры файлов:</strong> Анализ использования места</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul>
                                    <li><strong>Активность:</strong> Временные тренды</li>
                                    <li><strong>Дубликаты:</strong> Поиск повторяющихся файлов</li>
                                    <li><strong>Оптимизация:</strong> Рекомендации по улучшению</li>
                                </ul>
                            </div>
                        </div>
                        
                        <h6>Форматы экспорта:</h6>
                        <div class="d-flex gap-2 flex-wrap">
                            <span class="badge bg-primary">HTML</span>
                            <span class="badge bg-success">PDF</span>
                            <span class="badge bg-info">Excel</span>
                            <span class="badge bg-warning">CSV</span>
                            <span class="badge bg-dark">JSON</span>
                        </div>
                        
                        <div class="mt-3">
                            <h6>Планирование отчетов:</h6>
                            <p>Настройте автоматическую генерацию отчетов с заданной периодичностью и получайте их на email.</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Settings -->
            <section id="settings" class="mb-5">
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-cog me-2"></i>
                            Настройки
                        </h4>
                    </div>
                    <div class="card-body">
                        <p>Настройте систему под ваши потребности.</p>
                        
                        <h6>Основные разделы:</h6>
                        <div class="accordion" id="settingsAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#generalSettings">
                                        <i class="fas fa-sliders-h me-2"></i>
                                        Общие настройки
                                    </button>
                                </h2>
                                <div id="generalSettings" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                                    <div class="accordion-body">
                                        <ul>
                                            <li>Папки для сканирования</li>
                                            <li>Исключения и фильтры</li>
                                            <li>Язык интерфейса</li>
                                            <li>Тема оформления</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#searchSettings">
                                        <i class="fas fa-search me-2"></i>
                                        Настройки поиска
                                    </button>
                                </h2>
                                <div id="searchSettings" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                                    <div class="accordion-body">
                                        <ul>
                                            <li>Индексация содержимого</li>
                                            <li>Размер кэша</li>
                                            <li>Глубина поиска</li>
                                            <li>Игнорируемые расширения</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#apiSettings">
                                        <i class="fas fa-code me-2"></i>
                                        API настройки
                                    </button>
                                </h2>
                                <div id="apiSettings" class="accordion-collapse collapse" data-bs-parent="#settingsAccordion">
                                    <div class="accordion-body">
                                        <ul>
                                            <li>Ключи доступа</li>
                                            <li>Лимиты запросов</li>
                                            <li>Webhook URL</li>
                                            <li>Логирование API</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- API Documentation -->
            <section id="api" class="mb-5">
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        <h4 class="mb-0">
                            <i class="fas fa-code me-2"></i>
                            API документация
                        </h4>
                    </div>
                    <div class="card-body">
                        <p>DevDataSorter предоставляет RESTful API для интеграции с внешними системами.</p>
                        
                        <h6>Базовый URL:</h6>
                        <code>http://localhost:8080/api</code>
                        
                        <h6 class="mt-3">Основные эндпоинты:</h6>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Метод</th>
                                        <th>Эндпоинт</th>
                                        <th>Описание</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="badge bg-success">GET</span></td>
                                        <td><code>/files</code></td>
                                        <td>Получить список файлов</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-success">GET</span></td>
                                        <td><code>/search</code></td>
                                        <td>Поиск файлов</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-success">GET</span></td>
                                        <td><code>/stats</code></td>
                                        <td>Статистика системы</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-primary">POST</span></td>
                                        <td><code>/scan</code></td>
                                        <td>Запустить сканирование</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-primary">POST</span></td>
                                        <td><code>/reports</code></td>
                                        <td>Создать отчет</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <h6>Аутентификация:</h6>
                        <p>Используйте API ключ в заголовке запроса:</p>
                        <pre><code>Authorization: Bearer YOUR_API_KEY</code></pre>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Полная документация API доступна по адресу <code>/api/docs</code>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- FAQ -->
            <section id="faq" class="mb-5">
                <div class="card">
                    <div class="card-header" style="background-color: #6f42c1; color: white;">
                        <h4 class="mb-0">
                            <i class="fas fa-question me-2"></i>
                            Часто задаваемые вопросы
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="faqAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                        Как добавить новую папку для сканирования?
                                    </button>
                                </h2>
                                <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        Перейдите в раздел "Настройки" → "Общие" → "Папки для сканирования" и нажмите кнопку "Добавить папку". Выберите нужную директорию и сохраните настройки.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                        Почему поиск работает медленно?
                                    </button>
                                </h2>
                                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        Скорость поиска зависит от размера индекса и типа поиска. Поиск по содержимому файлов занимает больше времени. Рекомендуется использовать фильтры для сужения области поиска.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                        Как экспортировать результаты поиска?
                                    </button>
                                </h2>
                                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        На странице поиска нажмите кнопку "Экспорт" и выберите нужный формат (CSV, Excel, JSON). Экспорт будет содержать все найденные файлы с их метаданными.
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                        Можно ли настроить автоматическое сканирование?
                                    </button>
                                </h2>
                                <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        Да, в настройках индексации можно включить автоматическое сканирование и настроить его периодичность (ежедневно, еженедельно, ежемесячно).
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                                        Как исключить определенные файлы из индексации?
                                    </button>
                                </h2>
                                <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        В настройках общих параметров добавьте маски файлов или папок в список исключений. Поддерживаются wildcards (*, ?) и регулярные выражения.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Troubleshooting -->
            <section id="troubleshooting" class="mb-5">
                <div class="card">
                    <div class="card-header" style="background-color: #fd7e14; color: white;">
                        <h4 class="mb-0">
                            <i class="fas fa-tools me-2"></i>
                            Устранение неполадок
                        </h4>
                    </div>
                    <div class="card-body">
                        <h6>Общие проблемы и решения:</h6>
                        
                        <div class="alert alert-warning">
                            <h6><i class="fas fa-exclamation-triangle me-2"></i>Сканирование не запускается</h6>
                            <p class="mb-2"><strong>Возможные причины:</strong></p>
                            <ul class="mb-2">
                                <li>Недостаточно прав доступа к папкам</li>
                                <li>Папки не существуют или недоступны</li>
                                <li>Недостаточно места на диске</li>
                            </ul>
                            <p class="mb-0"><strong>Решение:</strong> Проверьте права доступа и наличие папок в настройках.</p>
                        </div>
                        
                        <div class="alert alert-danger">
                            <h6><i class="fas fa-times-circle me-2"></i>Ошибка подключения к базе данных</h6>
                            <p class="mb-2"><strong>Симптомы:</strong> Страницы не загружаются, ошибки в логах</p>
                            <p class="mb-0"><strong>Решение:</strong> Перезапустите службу, проверьте настройки подключения к БД.</p>
                        </div>
                        
                        <div class="alert alert-info">
                            <h6><i class="fas fa-clock me-2"></i>Медленная работа системы</h6>
                            <p class="mb-2"><strong>Рекомендации по оптимизации:</strong></p>
                            <ul class="mb-0">
                                <li>Увеличьте размер кэша в настройках</li>
                                <li>Исключите большие файлы из индексации</li>
                                <li>Используйте SSD для хранения индекса</li>
                                <li>Ограничьте глубину сканирования папок</li>
                            </ul>
                        </div>
                        
                        <h6>Логи и диагностика:</h6>
                        <p>Файлы логов находятся в папке <code>logs/</code>:</p>
                        <ul>
                            <li><code>application.log</code> - основные события</li>
                            <li><code>error.log</code> - ошибки системы</li>
                            <li><code>scan.log</code> - процесс сканирования</li>
                            <li><code>api.log</code> - запросы к API</li>
                        </ul>
                        
                        <div class="alert alert-success">
                            <i class="fas fa-life-ring me-2"></i>
                            Если проблема не решается, обратитесь в техническую поддержку с описанием проблемы и приложите соответствующие логи.
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>

<!-- Contact Support Modal -->
<div class="modal fade" id="supportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-envelope me-2"></i>
                    Связаться с поддержкой
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="supportForm">
                    <div class="mb-3">
                        <label for="supportName" class="form-label">Имя</label>
                        <input type="text" class="form-control" id="supportName" required>
                    </div>
                    <div class="mb-3">
                        <label for="supportEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="supportEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="supportSubject" class="form-label">Тема</label>
                        <select class="form-select" id="supportSubject" required>
                            <option value="">Выберите тему</option>
                            <option value="bug">Сообщение об ошибке</option>
                            <option value="feature">Запрос функции</option>
                            <option value="help">Помощь в использовании</option>
                            <option value="other">Другое</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="supportMessage" class="form-label">Сообщение</label>
                        <textarea class="form-control" id="supportMessage" rows="5" required></textarea>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeLogs">
                            <label class="form-check-label" for="includeLogs">
                                Включить системные логи
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary" onclick="sendSupportMessage()">Отправить</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Help page functionality
document.addEventListener('DOMContentLoaded', function() {
    initializeHelp();
    setupSmoothScrolling();
    setupSearchHighlighting();
});

function initializeHelp() {
    // Setup search functionality
    const searchInput = document.getElementById('helpSearch');
    searchInput.addEventListener('input', function() {
        searchHelp(this.value);
    });
    
    // Setup navigation highlighting
    setupNavigationHighlighting();
}

function setupSmoothScrolling() {
    // Smooth scrolling for navigation links
    document.querySelectorAll('#helpNavigation a').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // Update active navigation item
                updateActiveNavigation(this);
            }
        });
    });
}

function setupNavigationHighlighting() {
    // Highlight current section in navigation
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const id = entry.target.id;
                const navLink = document.querySelector(`#helpNavigation a[href="#${id}"]`);
                if (navLink) {
                    updateActiveNavigation(navLink);
                }
            }
        });
    }, {
        threshold: 0.3,
        rootMargin: '-100px 0px -50% 0px'
    });
    
    // Observe all sections
    document.querySelectorAll('section[id]').forEach(section => {
        observer.observe(section);
    });
}

function updateActiveNavigation(activeLink) {
    // Remove active class from all navigation items
    document.querySelectorAll('#helpNavigation a').forEach(link => {
        link.classList.remove('active');
    });
    
    // Add active class to current item
    activeLink.classList.add('active');
}

function setupSearchHighlighting() {
    // Store original content for search highlighting
    const sections = document.querySelectorAll('.help-content section');
    sections.forEach(section => {
        section.dataset.originalContent = section.innerHTML;
    });
}

function searchHelp(query = null) {
    const searchInput = document.getElementById('helpSearch');
    const searchTerm = query || searchInput.value.toLowerCase().trim();
    const sections = document.querySelectorAll('.help-content section');
    
    if (!searchTerm) {
        // Show all sections and remove highlighting
        sections.forEach(section => {
            section.style.display = 'block';
            section.innerHTML = section.dataset.originalContent;
        });
        return;
    }
    
    let hasResults = false;
    
    sections.forEach(section => {
        const originalContent = section.dataset.originalContent;
        const textContent = section.textContent.toLowerCase();
        
        if (textContent.includes(searchTerm)) {
            section.style.display = 'block';
            
            // Highlight search terms
            const highlightedContent = highlightSearchTerms(originalContent, searchTerm);
            section.innerHTML = highlightedContent;
            
            hasResults = true;
        } else {
            section.style.display = 'none';
        }
    });
    
    // Show message if no results
    if (!hasResults && searchTerm) {
        showNoSearchResults(searchTerm);
    } else {
        hideNoSearchResults();
    }
}

function highlightSearchTerms(content, searchTerm) {
    const regex = new RegExp(`(${escapeRegExp(searchTerm)})`, 'gi');
    return content.replace(regex, '<mark class="bg-warning">$1</mark>');
}

function escapeRegExp(string) {
    return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

function showNoSearchResults(searchTerm) {
    let noResultsDiv = document.getElementById('noSearchResults');
    
    if (!noResultsDiv) {
        noResultsDiv = document.createElement('div');
        noResultsDiv.id = 'noSearchResults';
        noResultsDiv.className = 'alert alert-info text-center';
        document.querySelector('.help-content').appendChild(noResultsDiv);
    }
    
    noResultsDiv.innerHTML = `
        <i class="fas fa-search fa-2x mb-3 text-muted"></i>
        <h5>Результаты не найдены</h5>
        <p>По запросу "<strong>${escapeHtml(searchTerm)}</strong>" ничего не найдено.</p>
        <button class="btn btn-outline-primary" onclick="clearSearch()">
            <i class="fas fa-times me-2"></i>
            Очистить поиск
        </button>
    `;
    
    noResultsDiv.style.display = 'block';
}

function hideNoSearchResults() {
    const noResultsDiv = document.getElementById('noSearchResults');
    if (noResultsDiv) {
        noResultsDiv.style.display = 'none';
    }
}

function clearSearch() {
    document.getElementById('helpSearch').value = '';
    searchHelp('');
}

function contactSupport() {
    new bootstrap.Modal(document.getElementById('supportModal')).show();
}

function sendSupportMessage() {
    const form = document.getElementById('supportForm');
    
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    const formData = {
        name: document.getElementById('supportName').value,
        email: document.getElementById('supportEmail').value,
        subject: document.getElementById('supportSubject').value,
        message: document.getElementById('supportMessage').value,
        includeLogs: document.getElementById('includeLogs').checked
    };
    
    // TODO: Implement support message sending
    showAlert('Сообщение отправлено! Мы свяжемся с вами в ближайшее время.', 'success');
    bootstrap.Modal.getInstance(document.getElementById('supportModal')).hide();
    form.reset();
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl+F or Cmd+F to focus search
    if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
        e.preventDefault();
        document.getElementById('helpSearch').focus();
    }
    
    // Escape to clear search
    if (e.key === 'Escape') {
        clearSearch();
    }
});
</script>

<style>
.help-content section {
    scroll-margin-top: 100px;
}

#helpNavigation .list-group-item {
    border: none;
    padding: 0.75rem 1rem;
    transition: all 0.2s;
}

#helpNavigation .list-group-item:hover {
    background-color: #f8f9fa;
    padding-left: 1.5rem;
}

#helpNavigation .list-group-item.active {
    background-color: #e3f2fd;
    border-left: 3px solid #2196f3;
    font-weight: 500;
}

.accordion-button:not(.collapsed) {
    background-color: #f8f9fa;
}

mark {
    padding: 0.1em 0.2em;
    border-radius: 0.2em;
}

code {
    background-color: #f8f9fa;
    padding: 0.2em 0.4em;
    border-radius: 0.25rem;
    font-size: 0.875em;
}

pre code {
    background-color: #f8f9fa;
    display: block;
    padding: 1rem;
    border-radius: 0.375rem;
    border: 1px solid #dee2e6;
}

.badge {
    font-size: 0.75em;
}

.alert h6 {
    margin-bottom: 0.5rem;
}

.sticky-top {
    z-index: 1020;
}

@media (max-width: 768px) {
    .sticky-top {
        position: relative !important;
        top: auto !important;
    }
}
</style>
{% endblock %}